@startuml Đáo hạn Vay
title Activity Diagram - Đáo hạn Khoản Vay

|Hệ thống|
start
:Quét khoản vay sắp đáo hạn (30 ngày);
:Gửi thông báo cho khách hàng;

|Khách hàng|
:Đăng nhập xem khoản vay;

|Hệ thống|
:Hiển thị dư nợ, lãi, tổng cần trả;

|Khách hàng|
if (Chọn phương án?) then (Trả hết)
  |Hệ thống|
  :Xử lý thanh toán toàn bộ;
  :Cập nhật trạng thái (PAID_OFF);
  if (Có tài sản thế chấp?) then (có)
    :Giải phóng tài sản;
  endif
  :Cộng điểm tín dụng;
  :Gửi xác nhận & biên lai;

elseif (Gia hạn)
  :Chọn thời gian, lãi suất đề xuất;
  
  |Hệ thống|
  :Tính toán lịch trả mới;
  :Hiển thị preview cho khách;
  
  |Khách hàng|
  :Xác nhận gửi yêu cầu;
  
  |Hệ thống|
  :Tạo yêu cầu gia hạn;
  
  |NV Tín dụng|
  :Thẩm định & quyết định;
  if (Phê duyệt?) then (có)
    |Hệ thống|
    :Cập nhật ngày đáo hạn & lịch trả;
    :Gửi thông báo phê duyệt;
  else (không)
    :Gửi thông báo từ chối;
  endif

else (Tái cấu trúc)
  :Chọn lại lãi suất, kỳ hạn, khoản trả;
  
  |Hệ thống|
  :Tính toán phương án mới;
  :Hiển thị so sánh với phương án hiện tại;
  
  |Khách hàng|
  :Xác nhận gửi yêu cầu;
  
  |Hệ thống|
  :Tạo yêu cầu tái cấu trúc;
  
  |NV Tín dụng|
  :Thẩm định & quyết định;
  if (Phê duyệt?) then (có)
    |Hệ thống|
    :Cập nhật thông tin khoản vay;
    :Gửi thông báo kết quả;
  else (không)
    :Gửi thông báo từ chối;
  endif
endif

stop

@enduml
