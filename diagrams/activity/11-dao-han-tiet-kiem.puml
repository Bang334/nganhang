@startuml Đáo hạn Tiết kiệm
title Activity Diagram - Đáo hạn Sổ Tiết kiệm

|Hệ thống|
start
:Quét sổ tiết kiệm sắp đáo hạn (7 ngày);
:Gửi thông báo tới khách hàng;
:Đến ngày đáo hạn -> cập nhật trạng thái (MATURED);

|Khách hàng|
:Đăng nhập xem sổ;

|Hệ thống|
:Hiển thị gốc, lãi, tổng và các lựa chọn;

|Khách hàng|
if (Tự động tái tục?) then (có)
  |Hệ thống|
  if (Tùy chọn tự động?) then (Gốc)
    :Chuyển lãi về tài khoản thanh toán;
    :Tạo sổ mới với gốc cũ;
  else (Gốc + Lãi)
    :Tạo sổ mới với gốc+lãi;
  endif
  :Đóng sổ cũ;
  :Gửi thông báo hoàn tất;

else (không)
  if (Khách chọn?) then (Rút tiền)
    |Hệ thống|
    :Hiển thị tổng nhận (gốc + lãi);
    
    |Khách hàng|
    :Xác nhận rút;
    
    |Hệ thống|
    :Cộng tiền vào tài khoản thanh toán;
    :Đóng sổ; 
    :Gửi biên lai;

  elseif (Tái tục Gốc) then
    :Chọn kỳ hạn mới (tùy chọn nạp thêm);
    
    |Hệ thống|
    :Tính lãi dự kiến & hiển thị preview;
    
    |Khách hàng|
    :Xác nhận tái tục;
    
    |Hệ thống|
    if (Có nạp thêm?) then (có)
      :Trừ tiền từ tài khoản;
    endif
    :Chuyển lãi về tài khoản;
    :Tạo sổ mới (chỉ gốc + nạp thêm);
    :Đóng sổ cũ;
    :Gửi thông báo;

  else (Tái tục Gốc + Lãi)
    :Chọn kỳ hạn mới (tùy chọn nạp thêm);
    
    |Hệ thống|
    :Tính lãi kép dự kiến & hiển thị preview;
    
    |Khách hàng|
    :Xác nhận tái tục;
    
    |Hệ thống|
    if (Có nạp thêm?) then (có)
      :Trừ tiền từ tài khoản;
    endif
    :Tạo sổ mới (gốc + lãi + nạp thêm);
    :Đóng sổ cũ;
    :Gửi thông báo;
  endif
endif

stop

@enduml
