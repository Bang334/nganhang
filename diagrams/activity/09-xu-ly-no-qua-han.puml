@startuml Xử lý Nợ Quá Hạn
title Activity Diagram - Xử lý Nợ Quá Hạn (Scheduled Job)

|Hệ thống|
start
:Chạy job hàng ngày (00:00);
:Tìm kỳ trả nợ quá hạn;

if (Có kỳ quá hạn?) then (có)
  repeat
    :Tính số ngày quá hạn;
    :Tính phí trễ;
    
    if (Số ngày?) then (1-7 ngày)
      :Gửi SMS/Email nhắc;
      :Gửi thông báo app;
      note right
      Chưa giảm điểm
      trong 7 ngày đầu
      end note
      
    elseif (8-30 ngày) then
      :Cập nhật phí trễ;
      :Gọi điện nhắc;
      :Giảm điểm -5;
      :Lưu CreditScoreHistory;
      
    elseif (31-90 ngày) then
      :Gửi cảnh báo nghiêm trọng;
      
      |NV Tín dụng|
      :Liên hệ KH;
      :Lên kế hoạch thu nợ;
      
      |Hệ thống|
      :Giảm điểm -20;
      :Khóa tính năng vay mới;
      :Lưu CreditScoreHistory;
      
    else (> 90 ngày)
      :Cập nhật (Nợ xấu);
      
      |NV Tín dụng|
      if (Có thế chấp?) then (có)
        :Khởi tạo thu hồi tài sản;
        :Chuẩn bị hồ sơ pháp lý;
      else (không)
        :Chuyển công ty thu nợ;
        :Báo cáo CIC;
      endif
      
      |Hệ thống|
      :Hạ điểm xuống 300-400;
      :Cập nhật hạng 'C' hoặc 'D';
      :Khóa toàn bộ tính năng vay;
      :Lưu CreditScoreHistory;
    endif
    
    :Lưu log;
  repeat while (Còn kỳ?) is (có)
  
  :Tạo báo cáo nợ quá hạn;
endif
stop

@enduml
