@startuml Chuyển khoản

title Nghiệp vụ: Chuyển khoản nội bộ

actor Customer
participant UI
participant Controller
participant DB

Customer -> UI: Nhập thông tin\nchuyển khoản
UI -> Controller: transfer(from, to, amount)

Controller -> DB: CHECK balance >= amount
alt Balance đủ
  DB -> DB: START TRANSACTION
  DB -> DB: UPDATE from_account\nSET balance = balance - amount
  DB -> DB: UPDATE to_account\nSET balance = balance + amount
  DB -> DB: INSERT transaction
  DB -> DB: COMMIT
  DB --> Controller: Success
  Controller --> UI: OK
  UI --> Customer: Chuyển khoản\nthành công!
else Balance không đủ
  DB --> Controller: Error
  Controller --> UI: Fail
  UI --> Customer: Số dư không đủ
end

@enduml

