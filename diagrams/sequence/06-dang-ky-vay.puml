@startuml Đăng ký Vay
autonumber
title Luồng Đăng ký Khoản Vay

actor "Khách hàng" as Customer
participant "Web/App" as App
participant "System" as System
database "Database" as DB

Customer -> App: Chọn "Đăng ký vay"
App -> System: Tải danh sách sản phẩm vay

System -> DB: Lấy các gói vay đang áp dụng
DB --> System: Trả về danh sách loại vay

System -> DB: Lấy bảng lãi suất hiện hành
DB --> System: Trả về các mức lãi suất

System --> App: Hiển thị form đăng ký

Customer -> App: Nhập thông tin khoản vay\n(Số tiền, kỳ hạn, mục đích)
App -> System: Tính lãi suất và khoản trả hàng tháng
System --> App: Kết quả tính toán

alt Vay có thế chấp
    Customer -> App: Chọn tài sản thế chấp
    
    alt Tài sản đã có
        App -> System: Yêu cầu danh sách tài sản khả dụng
        System -> DB: Lấy tài sản thế chấp của khách còn sử dụng được
        DB --> System: Trả về danh sách tài sản
        System --> App: Hiển thị tài sản
        Customer -> App: Chọn tài sản
    else Đăng ký tài sản mới
        Customer -> App: Nhập thông tin tài sản\n(Loại, giá trị, chứng từ)
        App -> System: Create Collateral
        System -> DB: Lưu tài sản chờ thẩm định
        DB --> System: Ghi nhận mã tài sản mới
    end
    
    App -> System: Tính LTV ratio
    System --> App: LTV = (Loan Amount / Collateral Value) * 100%
end

Customer -> App: Xác nhận đăng ký
App -> System: Submit Loan Application

System -> DB: BEGIN TRANSACTION

System -> DB: Lưu hồ sơ vay ở trạng thái CHỜ DUYỆT
DB --> System: Ghi nhận mã hồ sơ

System -> DB: Đánh dấu tài sản đã dùng làm thế chấp
DB --> System: Hoàn tất cập nhật

System -> DB: COMMIT

System --> App: Đăng ký thành công\n(Mã hồ sơ vay)
App --> Customer: Hiển thị mã hồ sơ\nvà thông báo chờ duyệt

@enduml

