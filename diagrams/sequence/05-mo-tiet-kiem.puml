@startuml Mở Sổ Tiết Kiệm
autonumber
title Luồng Mở Sổ Tiết Kiệm

actor "Khách hàng" as Customer
participant "Web/App" as App
participant "System" as System
database "Database" as DB

Customer -> App: Chọn "Gửi tiết kiệm"
App -> System: Yêu cầu bảng lãi suất tiết kiệm

System -> DB: Lấy danh sách lãi suất đang áp dụng
DB --> System: Trả về danh sách lãi suất

System --> App: Hiển thị các kỳ hạn\nvà lãi suất

Customer -> App: Nhập số tiền, kỳ hạn\nphương thức nhận lãi
App -> System: Tính lãi dự kiến
System --> App: Số tiền lãi dự kiến

Customer -> App: Xác nhận mở sổ
App -> System: Gửi yêu cầu mở sổ tiết kiệm

System -> DB: Bắt đầu ghi nhận giao dịch

System -> DB: Kiểm tra số dư tài khoản nguồn
DB --> System: Số dư hiện tại

alt Số dư đủ (min 1M)
    System -> DB: Trừ tiền khỏi tài khoản nguồn
    DB --> System: Xác nhận cập nhật
    
    System -> DB: Lưu thông tin sổ tiết kiệm mới
    DB --> System: Ghi nhận mã sổ tiết kiệm
    
    System -> DB: Ghi nhận giao dịch gửi tiết kiệm
    DB --> System: Xác nhận lưu giao dịch
    
    System -> DB: Hoàn tất ghi nhận
    
    System --> App: Mở sổ thành công\n(Số sổ tiết kiệm)
    App --> Customer: Hiển thị thông tin sổ\nvà lãi dự kiến
else Số dư không đủ
    System -> DB: Hủy ghi nhận
    System --> App: Lỗi: Số dư không đủ
    App --> Customer: Thông báo lỗi
end

@enduml

