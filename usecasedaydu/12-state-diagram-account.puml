@startuml State Diagram - Tài khoản
!theme plain

title Sơ đồ Trạng thái - Vòng đời Tài khoản (Account)

[*] --> PENDING_ACTIVATION : Tạo tài khoản mới

state PENDING_ACTIVATION {
  [*] --> AwaitingInitialDeposit
  AwaitingInitialDeposit : Chờ nạp tiền\nban đầu
}

PENDING_ACTIVATION --> ACTIVE : Nạp tiền\n≥ 100,000 VNĐ

state ACTIVE {
  [*] --> Normal
  Normal : Hoạt động\nbình thường
  Normal --> Normal : Giao dịch\nthành công
  Normal --> LowBalance : Số dư < min_balance
  LowBalance : Số dư thấp
  LowBalance --> Normal : Nạp tiền
  LowBalance --> Frozen : Âm tiền\n> 30 ngày
}

ACTIVE --> FROZEN : Phong tỏa\nbởi hệ thống

state FROZEN {
  [*] --> FrozenReason
  FrozenReason : Lý do phong tỏa:
  FrozenReason : - Giao dịch nghi ngờ\n- Yêu cầu pháp lý\n- Nợ quá hạn\n- Vi phạm điều khoản
}

FROZEN --> ACTIVE : Xử lý xong\nvấn đề

ACTIVE --> LOCKED : Khách hàng\nkhóa tạm thời

state LOCKED {
  [*] --> TemporarilyLocked
  TemporarilyLocked : Tạm khóa\nbởi KH
  TemporarilyLocked : Vẫn nhận tiền\nNhưng không rút/chuyển
}

LOCKED --> ACTIVE : Khách hàng\nmở khóa

ACTIVE --> DORMANT : Không giao dịch\n> 6 tháng

state DORMANT {
  [*] --> Inactive
  Inactive : Không hoạt động\nlâu ngày
  Inactive : Tính phí duy trì:\n10,000 VNĐ/tháng
}

DORMANT --> ACTIVE : Khách hàng\nkích hoạt lại

ACTIVE --> CLOSING : Yêu cầu\nđóng tài khoản

state CLOSING {
  [*] --> ValidateClosing
  ValidateClosing : Kiểm tra\nđiều kiện đóng
  ValidateClosing --> CheckLoans : OK
  CheckLoans : Không có\nkhoản vay
  CheckLoans --> CheckSavings
  CheckSavings : Không có\ntiết kiệm
  CheckSavings --> WithdrawBalance
  WithdrawBalance : Rút hết\nsố dư
}

CLOSING --> ACTIVE : Không đạt\nđiều kiện

CLOSING --> CLOSED : Hoàn tất\nđóng tài khoản

state CLOSED {
  [*] --> AccountClosed
  AccountClosed : Tài khoản\nđã đóng
  AccountClosed : Lưu trữ\nlịch sử 5 năm
}

CLOSED --> [*]

DORMANT --> CLOSED : Admin\nđóng tài khoản\nsau 2 năm không dùng

note right of ACTIVE
  **Trạng thái chính**
  - Có thể giao dịch tự do
  - Nạp/Rút/Chuyển khoản
  - Mở tiết kiệm
  - Đăng ký vay
end note

note right of FROZEN
  **Tài khoản bị phong tỏa:**
  - Không thể giao dịch
  - Cần xử lý với ngân hàng
  - Có thể do nợ hoặc pháp lý
end note

note right of DORMANT
  **Tài khoản ngủ:**
  - Không giao dịch > 6 tháng
  - Tính phí duy trì
  - Có thể kích hoạt lại
  - Tự động đóng sau 2 năm
end note

note right of CLOSED
  **Điều kiện đóng:**
  - Không có khoản vay
  - Không có tiết kiệm
  - Số dư = 0
  - Khách hàng xác nhận
end note

@enduml











