@startuml Chuyển Khoản
title Activity Diagram - Chuyển Khoản

|Khách hàng|
start
:Đăng nhập hệ thống;
:Chọn "Chuyển khoản";
:Nhập STK người nhận;

|Hệ thống|
:Tìm tài khoản người nhận;

if (TK người nhận tồn tại?) then (không)
  |Khách hàng|
  :Lỗi: STK không tồn tại;
  stop
else (có)
  |Hệ thống|
  :Hiển thị tên người nhận;
  
  |Khách hàng|
  :Nhập số tiền;
  :Nhập nội dung;
  :Xác nhận chuyển khoản;
  
  |Hệ thống|
  :BEGIN TRANSACTION;
  :Khóa tài khoản nguồn
  (FOR UPDATE);
  
  if (Số dư đủ?) then (không)
    :ROLLBACK;
    |Khách hàng|
    :Lỗi: Số dư không đủ;
    stop
  else (có)
    |Hệ thống|
    :UPDATE balance nguồn (-);
    :UPDATE balance đích (+);
    :INSERT Transaction;
    :COMMIT;
    
    |Khách hàng|
    :Hiển thị biên lai;
    :Gửi thông báo thành công;
    stop
  endif
endif

@enduml

