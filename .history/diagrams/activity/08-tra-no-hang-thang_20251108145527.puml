@startuml Trả Nợ
title Activity Diagram - Trả Nợ Khoản Vay

|Khách hàng|
start
:Đăng nhập;
:Chọn khoản vay;

if (Phương thức?) then (Tự động)
  |Hệ thống|
  if (Đến ngày trả?) then (có)
    if (Số dư đủ?) then (có)
      :Trừ tiền tự động;
      :Cập nhật lịch trả nợ;
      
      if (Trả đúng hạn?) then (có)
        :Tăng điểm +5;
      endif
      
      if (Đã trả hết?) then (có)
        :Cập nhật (PAID_OFF);
        if (Có thế chấp?) then (có)
          :Giải phóng tài sản;
        endif
        :Tăng điểm +15;
      endif
      
      :Gửi thông báo;
    else (không)
      :Ghi nhận quá hạn;
      :Gửi thông báo thiếu tiền;
    endif
  endif
  
else (Thủ công)
  |Khách hàng|
  :Chọn số kỳ trả;
  
  |Hệ thống|
  if (Số dư đủ?) then (có)
    :Trừ tiền;
    :Cập nhật lịch trả nợ;
    
    if (Trả đúng hạn/sớm?) then (có)
      :Tăng điểm +5 đến +10;
    else (trễ)
      :Giảm điểm;
    endif
    
    if (Đã trả hết?) then (có)
      :Cập nhật (PAID_OFF);
      if (Có thế chấp?) then (có)
        :Giải phóng tài sản;
      endif
      :Tăng điểm +15;
    endif
    
    |Khách hàng|
    :Hiển thị biên lai;
  else (không)
    :Lỗi: Số dư không đủ;
  endif
endif
stop

@enduml
