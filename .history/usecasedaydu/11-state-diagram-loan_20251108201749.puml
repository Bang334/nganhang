@startuml State Diagram - Khoản vay
!theme plain

title Sơ đồ Trạng thái - Vòng đời Khoản vay (Loan)

[*] --> PENDING : Khách hàng\nđăng ký vay

state PENDING {
  [*] --> SubmitApplication
  SubmitApplication : Hồ sơ mới nộp
  SubmitApplication : Chờ nhân viên xử lý
}

PENDING --> UNDER_REVIEW : Nhân viên\nbắt đầu thẩm định

state UNDER_REVIEW {
  [*] --> DocumentCheck
  DocumentCheck : Kiểm tra tài liệu
  DocumentCheck --> CICQuery : Đầy đủ
  CICQuery : Tra cứu CIC
  CICQuery --> DTICalculation
  DTICalculation : Tính DTI/LTV
  DTICalculation --> CollateralAppraisal : Có tài sản
  DTICalculation --> CompletedReview : Không có tài sản
  CollateralAppraisal : Thẩm định tài sản
  CollateralAppraisal --> CompletedReview
  CompletedReview : Hoàn tất thẩm định
}

UNDER_REVIEW --> NEED_MORE_INFO : Thiếu tài liệu
NEED_MORE_INFO --> UNDER_REVIEW : Bổ sung\ntài liệu

state NEED_MORE_INFO {
  [*] --> WaitingDocument
  WaitingDocument : Chờ khách hàng\nbổ sung
}

UNDER_REVIEW --> APPROVED : Phê duyệt\nvay
UNDER_REVIEW --> REJECTED : Từ chối

state APPROVED {
  [*] --> WaitingSigning
  WaitingSigning : Chờ ký hợp đồng
  WaitingSigning --> ContractSigned : Đã ký
  ContractSigned : Hợp đồng hoàn tất
}

APPROVED --> REJECTED : Khách hàng\ntừ chối điều khoản

APPROVED --> ACTIVE : Giải ngân và\nkích hoạt lịch trả nợ

state ACTIVE {
  [*] --> NormalPayment
  NormalPayment : Trả nợ đúng hạn
  NormalPayment --> NormalPayment : Trả kỳ hạn
  NormalPayment --> OverdueWarning : Quá hạn 1-7 ngày
  OverdueWarning : Nhắc nhở\ntrả nợ
  OverdueWarning --> NormalPayment : Trả nợ
  OverdueWarning --> Overdue : Quá hạn > 7 ngày
  Overdue : Nợ quá hạn
  Overdue --> NormalPayment : Trả nợ + phạt
  Overdue --> BadDebt : Quá hạn > 90 ngày
  BadDebt : Nợ xấu
  BadDebt : Xử lý pháp lý
  NormalPayment --> PaidOff : Trả hết nợ
  Overdue --> PaidOff : Trả hết nợ + phạt
}

ACTIVE --> OVERDUE : Không trả nợ\nquá 7 ngày

state OVERDUE {
  [*] --> EarlyOverdue
  EarlyOverdue : Nợ quá hạn\n8-30 ngày
  EarlyOverdue --> LateOverdue : Tiếp tục\nkhông trả
  LateOverdue : Nợ quá hạn\n31-90 ngày
  LateOverdue --> NonPerformingLoan : > 90 ngày
  NonPerformingLoan : Nợ xấu (NPL)
  NonPerformingLoan : Xử lý tài sản
}

OVERDUE --> ACTIVE : Thanh toán\nnợ + phạt

ACTIVE --> RESTRUCTURED : Cơ cấu lại\nnợ

state RESTRUCTURED {
  [*] --> NewTerms
  NewTerms : Thỏa thuận\nmới
  NewTerms --> RestructuredActive
  RestructuredActive : Trả nợ theo\nđiều khoản mới
}

RESTRUCTURED --> ACTIVE : Chấp nhận\nđiều khoản mới

ACTIVE --> PAID_OFF : Trả hết nợ
RESTRUCTURED --> PAID_OFF : Trả hết nợ

state PAID_OFF {
  [*] --> Completed
  Completed : Hoàn tất\nthanh toán
  Completed : Giải phóng\ntài sản
}

PAID_OFF --> [*]

state REJECTED {
  [*] --> RejectionReason
  RejectionReason : Lý do từ chối
  RejectionReason : - DTI quá cao\n- LTV không đạt\n- Credit score thấp\n- Nợ xấu
}

REJECTED --> [*]

OVERDUE --> WRITTEN_OFF : Xóa nợ\n(sau xử lý pháp lý)

state WRITTEN_OFF {
  [*] --> LegalProcess
  LegalProcess : Đã xử lý\npháp lý
  LegalProcess : Thu hồi tài sản
}

WRITTEN_OFF --> [*]

note right of PENDING
  **Trạng thái khởi đầu**
  - Hồ sơ mới được tạo
  - Chờ xử lý
end note

note right of APPROVED
  **Điều kiện phê duyệt:**
  - DTI ≤ 40%
  - LTV ≤ 70%
  - Credit score ≥ 600
  - Không có nợ xấu
end note

note right of ACTIVE
  **Trạng thái chính**
  - Khoản vay đang hoạt động
  - Theo dõi trả nợ hàng tháng
  - Cập nhật credit score
end note

note right of OVERDUE
  **Xử lý nợ quá hạn:**
  - 1-7 ngày: Nhắc nhở
  - 8-30 ngày: Phạt +3%/năm
  - 31-90 ngày: Cảnh báo
  - >90 ngày: NPL (Nợ xấu)
end note

@enduml






